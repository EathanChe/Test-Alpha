{
  "version": 3,
  "sources": ["../../../src/utils.ts", "../../../src/hallRoom.ts", "../../../src/worker.ts", "../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-kC6kAk/middleware-insertion-facade.js", "../../../node_modules/wrangler/templates/middleware/common.ts", "../bundle-kC6kAk/middleware-loader.entry.ts"],
  "sourceRoot": "D:\\Desktop\\Document\\Codes\\Test-Alpha\\backend\\.wrangler\\tmp\\dev-adFocF",
  "sourcesContent": ["const encoder = new TextEncoder();\nconst decoder = new TextDecoder();\nconst DEFAULT_TOKEN_SECRET = 'dev-token-secret';\n\nexport type SessionPayload = {\n  playerId: string;\n  hallId: string;\n  name: string;\n  ver: number;\n  exp: number;\n};\n\nexport function base64UrlEncode(data: ArrayBuffer | Uint8Array) {\n  const bytes = data instanceof Uint8Array ? data : new Uint8Array(data);\n  let binary = '';\n  bytes.forEach((byte) => {\n    binary += String.fromCharCode(byte);\n  });\n  return btoa(binary).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/g, '');\n}\n\nexport function base64UrlDecode(data: string) {\n  const padded = data.replace(/-/g, '+').replace(/_/g, '/').padEnd(Math.ceil(data.length / 4) * 4, '=');\n  const binary = atob(padded);\n  const bytes = new Uint8Array(binary.length);\n  for (let i = 0; i < binary.length; i += 1) {\n    bytes[i] = binary.charCodeAt(i);\n  }\n  return bytes;\n}\n\nconst DEFAULT_CORS_ORIGINS = ['http://localhost:5173', 'http://127.0.0.1:5173'];\n\nexport type CorsOptions = {\n  origin?: string | null;\n  allowedOrigins?: string[];\n};\n\nexport function parseCorsOrigins(raw?: string | null) {\n  if (!raw) return DEFAULT_CORS_ORIGINS;\n  const origins = raw\n    .split(',')\n    .map((value) => value.trim())\n    .filter(Boolean);\n  return origins.length > 0 ? origins : DEFAULT_CORS_ORIGINS;\n}\n\nexport function resolveCorsOrigin(requestOrigin: string | null, allowedOrigins: string[]) {\n  if (allowedOrigins.includes('*')) {\n    return '*';\n  }\n  if (requestOrigin && allowedOrigins.includes(requestOrigin)) {\n    return requestOrigin;\n  }\n  return allowedOrigins[0] ?? '';\n}\n\nexport function corsHeaders(options: CorsOptions = {}, init?: HeadersInit) {\n  const headers = new Headers(init);\n  const allowedOrigins = options.allowedOrigins ?? DEFAULT_CORS_ORIGINS;\n  const resolvedOrigin = resolveCorsOrigin(options.origin ?? null, allowedOrigins);\n  if (resolvedOrigin) {\n    headers.set('Access-Control-Allow-Origin', resolvedOrigin);\n    if (resolvedOrigin !== '*') {\n      headers.set('Vary', 'Origin');\n    }\n  }\n  headers.set('Access-Control-Allow-Methods', 'GET,POST,OPTIONS');\n  headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization');\n  return headers;\n}\n\nexport function jsonResponse(payload: unknown, init: ResponseInit = {}, cors?: CorsOptions) {\n  const headers = corsHeaders(cors, init.headers);\n  headers.set('Content-Type', 'application/json');\n  const status = init.status ?? 200;\n  if (status === 204 || status === 205 || status === 304) {\n    return new Response(null, { ...init, status, headers });\n  }\n  return new Response(JSON.stringify(payload), { ...init, status, headers });\n}\n\nexport async function readJson<T>(request: Request): Promise<T> {\n  const body = await request.json();\n  return body as T;\n}\n\nexport async function hashPassword(password: string, salt?: string) {\n  const resolvedSalt = salt ?? base64UrlEncode(crypto.getRandomValues(new Uint8Array(16)));\n  const key = await crypto.subtle.importKey('raw', encoder.encode(password), 'PBKDF2', false, ['deriveBits']);\n  const bits = await crypto.subtle.deriveBits(\n    {\n      name: 'PBKDF2',\n      salt: encoder.encode(resolvedSalt),\n      iterations: 100_000,\n      hash: 'SHA-256',\n    },\n    key,\n    256,\n  );\n  return { hash: base64UrlEncode(bits), salt: resolvedSalt };\n}\n\nexport async function verifyPassword(password: string, salt: string, hash: string) {\n  const result = await hashPassword(password, salt);\n  return result.hash === hash;\n}\n\nexport async function createSessionToken(payload: SessionPayload, secret: string) {\n  const data = encoder.encode(JSON.stringify(payload));\n  const key = await crypto.subtle.importKey(\n    'raw',\n    encoder.encode(secret),\n    { name: 'HMAC', hash: 'SHA-256' },\n    false,\n    ['sign'],\n  );\n  const signature = await crypto.subtle.sign('HMAC', key, data);\n  return `${base64UrlEncode(data)}.${base64UrlEncode(signature)}`;\n}\n\nexport async function verifySessionToken(token: string, secret: string) {\n  const [payloadPart, signaturePart] = token.split('.');\n  if (!payloadPart || !signaturePart) return null;\n  const payloadBytes = base64UrlDecode(payloadPart);\n  const signatureBytes = base64UrlDecode(signaturePart);\n  const key = await crypto.subtle.importKey(\n    'raw',\n    encoder.encode(secret),\n    { name: 'HMAC', hash: 'SHA-256' },\n    false,\n    ['verify'],\n  );\n  const ok = await crypto.subtle.verify('HMAC', key, signatureBytes, payloadBytes);\n  if (!ok) return null;\n  const payload = JSON.parse(decoder.decode(payloadBytes)) as SessionPayload;\n  if (payload.exp && Date.now() > payload.exp) return null;\n  return payload;\n}\n\nexport function randomHallCode() {\n  const alphabet = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';\n  let code = '';\n  for (let i = 0; i < 6; i += 1) {\n    code += alphabet[Math.floor(Math.random() * alphabet.length)];\n  }\n  return code;\n}\n\nexport function resolveTokenSecret(secret?: string | null) {\n  const trimmed = secret?.trim();\n  return trimmed && trimmed.length > 0 ? trimmed : DEFAULT_TOKEN_SECRET;\n}\n", "import { jsonResponse, resolveTokenSecret, verifySessionToken } from './utils';\n\nexport interface Env {\n  DB: D1Database;\n  TOKEN_SECRET: string;\n}\n\ntype ConnectionInfo = {\n  hallId: string;\n  playerId: string;\n  playerName: string;\n};\n\ntype RosterEntry = {\n  name: string;\n  isOnline: boolean;\n  inPrivate: boolean;\n};\n\ntype HallState = {\n  id: string;\n  code: string;\n  name: string;\n  dayNumber: number;\n  phase: string;\n};\n\ntype ChatMessage = {\n  id: string;\n  hallId: string;\n  sender: string;\n  content: string;\n  createdAt: number;\n};\n\ntype PrivateRequest = {\n  id: string;\n  initiatorId: string;\n  initiatorName: string;\n  targetId: string;\n  targetName: string;\n  status: string;\n  createdAt: number;\n};\n\ntype PrivateSession = {\n  id: string;\n  participants: string[];\n  status: 'ACTIVE' | 'ENDED';\n  dayNumber: number;\n  createdAt: number;\n  endedAt: number | null;\n  endedByName: string | null;\n};\n\ntype PrivateMessage = {\n  id: string;\n  sessionId: string;\n  sender: string;\n  content: string;\n  createdAt: number;\n};\n\ntype ClientMessage =\n  | { type: 'chat:send'; content?: string }\n  | { type: 'private:send'; sessionId?: string; content?: string }\n  | { type: 'private:end'; sessionId?: string }\n  | { type: 'ping' };\n\ntype ServerMessage =\n  | {\n      type: 'init';\n      messages: ChatMessage[];\n      roster: RosterEntry[];\n      hall: HallState | null;\n      privateRequests: PrivateRequest[];\n      privateSessions: PrivateSession[];\n      privateMessages: Record<string, PrivateMessage[]>;\n    }\n  | { type: 'chat:new'; message: ChatMessage }\n  | { type: 'presence:update'; roster: RosterEntry[] }\n  | { type: 'hall:update'; hall: HallState }\n  | { type: 'private:request'; request: PrivateRequest }\n  | { type: 'private:request-update'; request: PrivateRequest }\n  | { type: 'private:session-start'; session: PrivateSession }\n  | { type: 'private:session-end'; sessionId: string; endedByName: string | null }\n  | { type: 'private:message'; message: PrivateMessage }\n  | { type: 'pong' }\n  | { type: 'system'; message: string };\n\ntype BroadcastMessage = ServerMessage & { recipients?: string[] };\n\ntype SessionMember = { playerId: string; playerName: string };\n\nexport class HallRoom {\n  private state: DurableObjectState;\n  private env: Env;\n  private connections = new Map<WebSocket, ConnectionInfo>();\n\n  constructor(state: DurableObjectState, env: Env) {\n    this.state = state;\n    this.env = env;\n  }\n\n  async fetch(request: Request) {\n    if (request.method === 'POST' && new URL(request.url).pathname.endsWith('/broadcast')) {\n      const payload = (await request.json()) as BroadcastMessage;\n      this.broadcastToHall(payload);\n      return jsonResponse({ ok: true });\n    }\n\n    if (request.headers.get('Upgrade') !== 'websocket') {\n      return new Response('Expected WebSocket', { status: 426 });\n    }\n\n    const hallId = request.headers.get('X-Hall-Id');\n    const token = request.headers.get('X-Session-Token');\n    if (!hallId || !token) {\n      return new Response('Missing auth headers', { status: 400 });\n    }\n\n    const session = await verifySessionToken(token, resolveTokenSecret(this.env.TOKEN_SECRET));\n    if (!session || session.hallId !== hallId) {\n      return new Response('Unauthorized', { status: 401 });\n    }\n\n    const playerRow = await this.env.DB.prepare(\n      'SELECT session_version, name FROM players WHERE id = ? AND hall_id = ?',\n    )\n      .bind(session.playerId, hallId)\n      .first<{ session_version: number; name: string }>();\n\n    if (!playerRow || playerRow.session_version !== session.ver) {\n      return new Response('Unauthorized', { status: 401 });\n    }\n\n    const pair = new WebSocketPair();\n    const [client, server] = Object.values(pair) as [WebSocket, WebSocket];\n\n    this.disconnectOtherSessions(session.playerId);\n\n    server.accept();\n    this.connections.set(server, {\n      hallId,\n      playerId: session.playerId,\n      playerName: session.name,\n    });\n\n    server.addEventListener('message', (event) => {\n      this.handleMessage(server, event).catch((error) => {\n        console.error('WS message error', error);\n      });\n    });\n\n    server.addEventListener('close', () => {\n      this.handleClose(server).catch((error) => {\n        console.error('WS close error', error);\n      });\n    });\n\n    server.addEventListener('error', () => {\n      this.handleClose(server).catch((error) => {\n        console.error('WS error', error);\n      });\n    });\n\n    await this.markOnline(session.playerId);\n    await this.sendInit(server, hallId, session.playerId);\n    await this.broadcastPresence(hallId);\n\n    return new Response(null, { status: 101, webSocket: client });\n  }\n\n  private disconnectOtherSessions(playerId: string) {\n    const socketsToClose: WebSocket[] = [];\n    this.connections.forEach((info, ws) => {\n      if (info.playerId === playerId) {\n        socketsToClose.push(ws);\n      }\n    });\n\n    socketsToClose.forEach((ws) => {\n      ws.close(4001, 'Session replaced');\n      this.connections.delete(ws);\n    });\n  }\n\n  private async markOnline(playerId: string) {\n    const now = Date.now();\n    await this.env.DB.prepare('UPDATE players SET is_online = 1, last_seen_at = ? WHERE id = ?')\n      .bind(now, playerId)\n      .run();\n  }\n\n  private async markOfflineIfIdle(playerId: string) {\n    const stillConnected = Array.from(this.connections.values()).some((info) => info.playerId === playerId);\n    if (stillConnected) return;\n    const now = Date.now();\n    await this.env.DB.prepare('UPDATE players SET is_online = 0, last_seen_at = ? WHERE id = ?')\n      .bind(now, playerId)\n      .run();\n  }\n\n  private async sendInit(ws: WebSocket, hallId: string, playerId: string) {\n    const messages = await this.fetchRecentMessages(hallId, 50);\n    const roster = await this.fetchRoster(hallId);\n    const hall = await this.fetchHall(hallId);\n    const privateRequests = await this.fetchPrivateRequests(hallId, playerId);\n    const privateSessions = await this.fetchPrivateSessions(hallId, playerId);\n    const privateMessages = await this.fetchPrivateMessages(privateSessions);\n    const payload: ServerMessage = {\n      type: 'init',\n      messages,\n      roster,\n      hall,\n      privateRequests,\n      privateSessions,\n      privateMessages,\n    };\n    ws.send(JSON.stringify(payload));\n  }\n\n  private async fetchHall(hallId: string) {\n    return await this.env.DB.prepare(\n      'SELECT id, code, name, day_number as dayNumber, phase FROM halls WHERE id = ? LIMIT 1',\n    )\n      .bind(hallId)\n      .first<HallState>();\n  }\n\n  private async fetchRecentMessages(hallId: string, limit: number) {\n    const result = await this.env.DB.prepare(\n      'SELECT id, hall_id as hallId, player_name as sender, content, created_at as createdAt FROM messages WHERE hall_id = ? ORDER BY created_at DESC LIMIT ?',\n    )\n      .bind(hallId, limit)\n      .all<ChatMessage>();\n\n    return result.results.reverse();\n  }\n\n  private async fetchRoster(hallId: string) {\n    const result = await this.env.DB.prepare(\n      `SELECT\n        p.name as name,\n        p.is_online as isOnline,\n        EXISTS (\n          SELECT 1\n          FROM private_session_members m\n          JOIN private_sessions s ON s.id = m.session_id\n          WHERE s.hall_id = p.hall_id AND s.status = 'ACTIVE' AND m.player_id = p.id\n        ) as inPrivate\n      FROM players p\n      WHERE p.hall_id = ?\n      ORDER BY p.created_at`,\n    )\n      .bind(hallId)\n      .all<{ name: string; isOnline: number; inPrivate: number }>();\n\n    return result.results.map((row) => ({\n      name: row.name,\n      isOnline: row.isOnline === 1,\n      inPrivate: row.inPrivate === 1,\n    }));\n  }\n\n  private async fetchPrivateRequests(hallId: string, playerId: string) {\n    const result = await this.env.DB.prepare(\n      `SELECT\n        id,\n        initiator_id as initiatorId,\n        initiator_name as initiatorName,\n        target_id as targetId,\n        target_name as targetName,\n        status,\n        created_at as createdAt\n      FROM private_requests\n      WHERE hall_id = ? AND status = 'PENDING' AND (target_id = ? OR initiator_id = ?)\n      ORDER BY created_at DESC`,\n    )\n      .bind(hallId, playerId, playerId)\n      .all<PrivateRequest>();\n\n    return result.results;\n  }\n\n  private async fetchPrivateSessions(hallId: string, playerId: string) {\n    const result = await this.env.DB.prepare(\n      `SELECT\n        s.id as id,\n        s.day_number as dayNumber,\n        s.status as status,\n        s.created_at as createdAt,\n        s.ended_at as endedAt,\n        s.ended_by_name as endedByName\n      FROM private_sessions s\n      JOIN private_session_members m ON m.session_id = s.id\n      WHERE s.hall_id = ? AND m.player_id = ?\n      ORDER BY s.created_at DESC`,\n    )\n      .bind(hallId, playerId)\n      .all<Omit<PrivateSession, 'participants'>>();\n\n    const sessions: PrivateSession[] = [];\n    for (const row of result.results) {\n      const members = await this.env.DB.prepare(\n        'SELECT player_name as playerName FROM private_session_members WHERE session_id = ? ORDER BY player_name',\n      )\n        .bind(row.id)\n        .all<{ playerName: string }>();\n\n      sessions.push({\n        ...row,\n        participants: members.results.map((member) => member.playerName),\n        status: row.status as 'ACTIVE' | 'ENDED',\n        endedAt: row.endedAt ?? null,\n        endedByName: row.endedByName ?? null,\n      });\n    }\n\n    return sessions;\n  }\n\n  private async fetchPrivateMessages(sessions: PrivateSession[]) {\n    const result: Record<string, PrivateMessage[]> = {};\n    for (const session of sessions) {\n      const messages = await this.env.DB.prepare(\n        'SELECT id, session_id as sessionId, sender_name as sender, content, created_at as createdAt FROM private_messages WHERE session_id = ? ORDER BY created_at ASC',\n      )\n        .bind(session.id)\n        .all<PrivateMessage>();\n      result[session.id] = messages.results;\n    }\n    return result;\n  }\n\n  private async broadcastPresence(hallId: string) {\n    const roster = await this.fetchRoster(hallId);\n    const payload: ServerMessage = { type: 'presence:update', roster };\n    this.broadcastToHall(payload, hallId);\n  }\n\n  private broadcastToHall(payload: BroadcastMessage, hallId?: string) {\n    const { recipients, ...message } = payload;\n    const data = JSON.stringify(message);\n    this.connections.forEach((info, ws) => {\n      if (hallId && info.hallId !== hallId) return;\n      if (recipients && !recipients.includes(info.playerId)) return;\n      try {\n        ws.send(data);\n      } catch (error) {\n        console.error('WS send error', error);\n      }\n    });\n  }\n\n  private async ensureDay(ws: WebSocket, hallId: string) {\n    const hall = await this.fetchHall(hallId);\n    if (hall?.phase === 'NIGHT') {\n      ws.send(JSON.stringify({ type: 'system', message: '\u9ED1\u591C\u4E2D\u65E0\u6CD5\u6267\u884C\u8BE5\u64CD\u4F5C\u3002' } satisfies ServerMessage));\n      return false;\n    }\n    return true;\n  }\n\n  private async handleMessage(ws: WebSocket, event: MessageEvent) {\n    const info = this.connections.get(ws);\n    if (!info) return;\n\n    let payload: ClientMessage | null = null;\n    try {\n      payload = JSON.parse(typeof event.data === 'string' ? event.data : '') as ClientMessage;\n    } catch {\n      payload = null;\n    }\n\n    if (!payload) return;\n\n    if (payload.type === 'ping') {\n      ws.send(JSON.stringify({ type: 'pong' } satisfies ServerMessage));\n      return;\n    }\n\n    if (payload.type === 'chat:send') {\n      const content = (payload.content ?? '').trim();\n      if (!content) return;\n      if (!(await this.ensureDay(ws, info.hallId))) return;\n      const message: ChatMessage = {\n        id: crypto.randomUUID(),\n        hallId: info.hallId,\n        sender: info.playerName,\n        content,\n        createdAt: Date.now(),\n      };\n\n      await this.env.DB.prepare(\n        'INSERT INTO messages (id, hall_id, player_id, player_name, content, created_at) VALUES (?, ?, ?, ?, ?, ?)',\n      )\n        .bind(message.id, info.hallId, info.playerId, info.playerName, message.content, message.createdAt)\n        .run();\n\n      this.broadcastToHall({ type: 'chat:new', message }, info.hallId);\n      return;\n    }\n\n    if (payload.type === 'private:send') {\n      const sessionId = payload.sessionId?.trim();\n      const content = (payload.content ?? '').trim();\n      if (!sessionId || !content) return;\n      if (!(await this.ensureDay(ws, info.hallId))) return;\n      const members = await this.fetchSessionMembers(sessionId);\n      if (!members.some((member) => member.playerId === info.playerId)) return;\n\n      const message: PrivateMessage = {\n        id: crypto.randomUUID(),\n        sessionId,\n        sender: info.playerName,\n        content,\n        createdAt: Date.now(),\n      };\n\n      await this.env.DB.prepare(\n        'INSERT INTO private_messages (id, session_id, sender_id, sender_name, content, created_at) VALUES (?, ?, ?, ?, ?, ?)',\n      )\n        .bind(message.id, sessionId, info.playerId, info.playerName, message.content, message.createdAt)\n        .run();\n\n      this.broadcastToHall(\n        { type: 'private:message', message, recipients: members.map((member) => member.playerId) },\n        info.hallId,\n      );\n      return;\n    }\n\n    if (payload.type === 'private:end') {\n      const sessionId = payload.sessionId?.trim();\n      if (!sessionId) return;\n      const members = await this.fetchSessionMembers(sessionId);\n      if (!members.some((member) => member.playerId === info.playerId)) return;\n      const now = Date.now();\n\n      await this.env.DB.prepare(\n        'UPDATE private_sessions SET status = ?, ended_at = ?, ended_by_name = ? WHERE id = ?',\n      )\n        .bind('ENDED', now, info.playerName, sessionId)\n        .run();\n\n      this.broadcastToHall(\n        {\n          type: 'private:session-end',\n          sessionId,\n          endedByName: info.playerName,\n          recipients: members.map((member) => member.playerId),\n        },\n        info.hallId,\n      );\n    }\n  }\n\n  private async fetchSessionMembers(sessionId: string) {\n    const result = await this.env.DB.prepare(\n      'SELECT player_id as playerId, player_name as playerName FROM private_session_members WHERE session_id = ?',\n    )\n      .bind(sessionId)\n      .all<SessionMember>();\n\n    return result.results;\n  }\n\n  private async handleClose(ws: WebSocket) {\n    const info = this.connections.get(ws);\n    if (!info) return;\n    this.connections.delete(ws);\n    await this.markOfflineIfIdle(info.playerId);\n    await this.broadcastPresence(info.hallId);\n  }\n}\r\n", "import { HallRoom } from './hallRoom';\nimport {\n  CorsOptions,\n  corsHeaders,\n  createSessionToken,\n  hashPassword,\n  jsonResponse,\n  parseCorsOrigins,\n  randomHallCode,\n  readJson,\n  resolveTokenSecret,\n  verifyPassword,\n  verifySessionToken,\n} from './utils';\n\nexport { HallRoom };\n\nexport interface Env {\n  DB: D1Database;\n  HALL_ROOM: DurableObjectNamespace;\n  TOKEN_SECRET: string;\n  CORS_ORIGINS?: string;\n}\n\ntype HallRow = {\n  id: string;\n  code: string;\n  name: string;\n  password_hash: string;\n  password_salt: string;\n  phase: string;\n  day_number: number;\n  status: string;\n  storyteller_key: string;\n};\n\ntype CreateHallBody = {\n  name: string;\n  password: string;\n};\n\ntype JoinHallBody = {\n  playerName: string;\n  password: string;\n};\n\ntype ResetDayBody = {\n  storytellerKey: string;\n};\n\ntype AdvancePhaseBody = {\n  storytellerKey: string;\n  action: 'END_DAY' | 'START_DAY';\n};\n\ntype CreatePrivateRequestBody = {\n  targetName: string;\n};\n\ntype RespondPrivateRequestBody = {\n  response: 'ACCEPT' | 'REJECT';\n};\n\nconst MAX_MESSAGES = 50;\nconst SESSION_TTL_MS = 1000 * 60 * 60 * 24 * 7;\n\nexport default {\n  async fetch(request: Request, env: Env) {\n    const cors = buildCorsOptions(request, env);\n    if (request.method === 'OPTIONS') {\n      return new Response(null, {\n        status: 204,\n        headers: corsHeaders(cors),\n      });\n    }\n\n    const url = new URL(request.url);\n    const path = url.pathname;\n\n    if (path === '/api/halls' && request.method === 'POST') {\n      return handleCreateHall(request, env, cors);\n    }\n\n    if (path === '/api/halls' && request.method === 'GET') {\n      return handleListHalls(env, cors);\n    }\n\n    const joinMatch = path.match(/^\\/api\\/halls\\/([^/]+)\\/join$/);\n    if (joinMatch && request.method === 'POST') {\n      return handleJoinHall(request, env, joinMatch[1], cors);\n    }\n\n    const hallMatch = path.match(/^\\/api\\/halls\\/([^/]+)$/);\n    if (hallMatch && request.method === 'GET') {\n      return handleGetHall(env, hallMatch[1], cors);\n    }\n\n    const messagesMatch = path.match(/^\\/api\\/halls\\/([^/]+)\\/messages$/);\n    if (messagesMatch && request.method === 'GET') {\n      return handleGetMessages(request, env, messagesMatch[1], cors);\n    }\n\n    const rosterMatch = path.match(/^\\/api\\/halls\\/([^/]+)\\/roster$/);\n    if (rosterMatch && request.method === 'GET') {\n      return handleGetRoster(request, env, rosterMatch[1], cors);\n    }\n\n    const resetMatch = path.match(/^\\/api\\/halls\\/([^/]+)\\/admin\\/reset-day$/);\n    if (resetMatch && request.method === 'POST') {\n      return handleResetDay(request, env, resetMatch[1], cors);\n    }\n\n    const phaseMatch = path.match(/^\\/api\\/halls\\/([^/]+)\\/admin\\/phase$/);\n    if (phaseMatch && request.method === 'POST') {\n      return handleAdvancePhase(request, env, phaseMatch[1], cors);\n    }\n\n    const privateRequestMatch = path.match(/^\\/api\\/halls\\/([^/]+)\\/private-requests$/);\n    if (privateRequestMatch && request.method === 'POST') {\n      return handleCreatePrivateRequest(request, env, privateRequestMatch[1], cors);\n    }\n\n    const privateRespondMatch = path.match(/^\\/api\\/halls\\/([^/]+)\\/private-requests\\/([^/]+)\\/respond$/);\n    if (privateRespondMatch && request.method === 'POST') {\n      return handleRespondPrivateRequest(request, env, privateRespondMatch[1], privateRespondMatch[2], cors);\n    }\n\n    const wsMatch = path.match(/^\\/ws\\/halls\\/([^/]+)$/);\n    if (wsMatch) {\n      return handleWebSocket(request, env, wsMatch[1]);\n    }\n\n    return jsonResponse({ error: 'Not found' }, { status: 404 }, cors);\n  },\n};\n\nasync function handleCreateHall(request: Request, env: Env, cors: CorsOptions) {\n  const body = await readJson<CreateHallBody>(request);\n  const name = body.name?.trim();\n  const password = body.password?.trim();\n  if (!name || !password) {\n    return jsonResponse({ error: '\u7F3A\u5C11\u5927\u5385\u540D\u79F0\u6216\u5BC6\u7801' }, { status: 400 }, cors);\n  }\n\n  const { hash, salt } = await hashPassword(password);\n  const hallId = crypto.randomUUID();\n  const hallCode = await generateUniqueHallCode(env);\n  const storytellerKey = crypto.randomUUID();\n  const now = Date.now();\n\n  await env.DB.prepare(\n    'INSERT INTO halls (id, code, name, password_hash, password_salt, phase, day_number, status, storyteller_key, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)',\n  )\n    .bind(hallId, hallCode, name, hash, salt, 'DAY', 1, 'active', storytellerKey, now, now)\n    .run();\n\n  return jsonResponse({ hallId, hallCode, storytellerKey }, {}, cors);\n}\n\nasync function handleListHalls(env: Env, cors: CorsOptions) {\n  const result = await env.DB.prepare(\n    `SELECT\n      h.id,\n      h.code,\n      h.name,\n      h.day_number as dayNumber,\n      h.phase,\n      h.created_at as createdAt,\n      (\n        SELECT COUNT(1) FROM players p WHERE p.hall_id = h.id AND p.is_online = 1\n      ) as onlineCount\n    FROM halls h\n    WHERE h.status = 'active'\n    ORDER BY h.created_at DESC`,\n  ).all();\n\n  return jsonResponse({ halls: result.results }, {}, cors);\n}\n\nasync function handleJoinHall(request: Request, env: Env, code: string, cors: CorsOptions) {\n  const body = await readJson<JoinHallBody>(request);\n  const playerName = body.playerName?.trim();\n  const password = body.password?.trim();\n  if (!playerName || !password) {\n    return jsonResponse({ error: '\u7F3A\u5C11\u6635\u79F0\u6216\u5BC6\u7801' }, { status: 400 }, cors);\n  }\n\n  const hall = await env.DB.prepare(\n    'SELECT id, name, code, password_hash, password_salt, phase, day_number FROM halls WHERE code = ? AND status = ? LIMIT 1',\n  )\n    .bind(code, 'active')\n    .first<HallRow>();\n\n  if (!hall) {\n    return jsonResponse({ error: '\u5927\u5385\u4E0D\u5B58\u5728' }, { status: 404 }, cors);\n  }\n\n  const passwordOk = await verifyPassword(password, hall.password_salt, hall.password_hash);\n  if (!passwordOk) {\n    return jsonResponse({ error: '\u5BC6\u7801\u4E0D\u6B63\u786E' }, { status: 401 }, cors);\n  }\n\n  const now = Date.now();\n  const existingPlayer = await env.DB.prepare(\n    'SELECT id, session_version FROM players WHERE hall_id = ? AND name = ? LIMIT 1',\n  )\n    .bind(hall.id, playerName)\n    .first<{ id: string; session_version: number }>();\n\n  let playerId = crypto.randomUUID();\n  let sessionVersion = 1;\n\n  if (existingPlayer) {\n    playerId = existingPlayer.id;\n    sessionVersion = existingPlayer.session_version + 1;\n    await env.DB.prepare(\n      'UPDATE players SET session_version = ?, is_online = 1, last_seen_at = ? WHERE id = ?',\n    )\n      .bind(sessionVersion, now, playerId)\n      .run();\n  } else {\n    await env.DB.prepare(\n      'INSERT INTO players (id, hall_id, name, session_version, is_online, last_seen_at, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)',\n    )\n      .bind(playerId, hall.id, playerName, sessionVersion, 1, now, now)\n      .run();\n  }\n\n  const sessionToken = await createSessionToken(\n    {\n      playerId,\n      hallId: hall.id,\n      name: playerName,\n      ver: sessionVersion,\n      exp: now + SESSION_TTL_MS,\n    },\n    getTokenSecret(env),\n  );\n\n  return jsonResponse(\n    {\n      playerId,\n      sessionToken,\n      hall: {\n        id: hall.id,\n        code: hall.code,\n        name: hall.name,\n        dayNumber: hall.day_number,\n        phase: hall.phase,\n      },\n    },\n    undefined,\n    cors,\n  );\n}\n\nasync function handleGetHall(env: Env, code: string, cors: CorsOptions) {\n  const hall = await env.DB.prepare(\n    'SELECT id, code, name, day_number as dayNumber, phase FROM halls WHERE code = ? AND status = ? LIMIT 1',\n  )\n    .bind(code, 'active')\n    .first();\n\n  if (!hall) {\n    return jsonResponse({ error: '\u5927\u5385\u4E0D\u5B58\u5728' }, { status: 404 }, cors);\n  }\n\n  return jsonResponse({ hall }, {}, cors);\n}\n\nasync function handleGetMessages(request: Request, env: Env, code: string, cors: CorsOptions) {\n  const hall = await env.DB.prepare('SELECT id FROM halls WHERE code = ? AND status = ? LIMIT 1')\n    .bind(code, 'active')\n    .first<{ id: string }>();\n\n  if (!hall) {\n    return jsonResponse({ error: '\u5927\u5385\u4E0D\u5B58\u5728' }, { status: 404 }, cors);\n  }\n\n  const token = getToken(request);\n  const session = await requireSession(env, hall.id, token);\n  if (!session) {\n    return jsonResponse({ error: '\u672A\u6388\u6743' }, { status: 401 }, cors);\n  }\n\n  const limit = Math.min(Number(new URL(request.url).searchParams.get('limit') ?? MAX_MESSAGES), 100);\n  const result = await env.DB.prepare(\n    'SELECT id, hall_id as hallId, player_name as sender, content, created_at as createdAt FROM messages WHERE hall_id = ? ORDER BY created_at DESC LIMIT ?',\n  )\n    .bind(hall.id, limit)\n    .all();\n\n  const messages = result.results.slice().reverse();\n  return jsonResponse({ messages }, {}, cors);\n}\n\nasync function handleGetRoster(request: Request, env: Env, code: string, cors: CorsOptions) {\n  const hall = await env.DB.prepare('SELECT id FROM halls WHERE code = ? AND status = ? LIMIT 1')\n    .bind(code, 'active')\n    .first<{ id: string }>();\n\n  if (!hall) {\n    return jsonResponse({ error: '\u5927\u5385\u4E0D\u5B58\u5728' }, { status: 404 }, cors);\n  }\n\n  const token = getToken(request);\n  const session = await requireSession(env, hall.id, token);\n  if (!session) {\n    return jsonResponse({ error: '\u672A\u6388\u6743' }, { status: 401 }, cors);\n  }\n\n  const result = await env.DB.prepare(\n    `SELECT\n      p.name as name,\n      p.is_online as isOnline,\n      EXISTS (\n        SELECT 1\n        FROM private_session_members m\n        JOIN private_sessions s ON s.id = m.session_id\n        WHERE s.hall_id = p.hall_id AND s.status = 'ACTIVE' AND m.player_id = p.id\n      ) as inPrivate\n    FROM players p\n    WHERE p.hall_id = ?\n    ORDER BY p.created_at`,\n  )\n    .bind(hall.id)\n    .all();\n\n  return jsonResponse({ players: result.results }, {}, cors);\n}\n\nasync function handleResetDay(request: Request, env: Env, code: string, cors: CorsOptions) {\n  const body = await readJson<ResetDayBody>(request);\n  const storytellerKey = body.storytellerKey?.trim();\n  if (!storytellerKey) {\n    return jsonResponse({ error: '\u7F3A\u5C11 storytellerKey' }, { status: 400 }, cors);\n  }\n\n  const hall = await env.DB.prepare('SELECT id, storyteller_key FROM halls WHERE code = ? LIMIT 1')\n    .bind(code)\n    .first<HallRow>();\n\n  if (!hall || hall.storyteller_key !== storytellerKey) {\n    return jsonResponse({ error: '\u65E0\u6743\u9650\u64CD\u4F5C' }, { status: 403 }, cors);\n  }\n\n  const now = Date.now();\n  await env.DB.prepare('UPDATE halls SET day_number = 1, phase = ?, updated_at = ? WHERE id = ?')\n    .bind('DAY', now, hall.id)\n    .run();\n  await env.DB.prepare('DELETE FROM messages WHERE hall_id = ?').bind(hall.id).run();\n  await env.DB.prepare('DELETE FROM private_requests WHERE hall_id = ?').bind(hall.id).run();\n  await env.DB.prepare('DELETE FROM private_messages WHERE session_id IN (SELECT id FROM private_sessions WHERE hall_id = ?)').bind(hall.id).run();\n  await env.DB.prepare('DELETE FROM private_session_members WHERE session_id IN (SELECT id FROM private_sessions WHERE hall_id = ?)').bind(hall.id).run();\n  await env.DB.prepare('DELETE FROM private_sessions WHERE hall_id = ?').bind(hall.id).run();\n\n  const updated = await env.DB.prepare(\n    'SELECT id, code, name, day_number as dayNumber, phase FROM halls WHERE id = ? LIMIT 1',\n  )\n    .bind(hall.id)\n    .first();\n\n  await broadcastToHall(env, hall.id, {\n    type: 'hall:update',\n    hall: updated as { id: string; code: string; name: string; dayNumber: number; phase: string },\n  });\n  await broadcastToHall(env, hall.id, {\n    type: 'system',\n    message: '\u8BF4\u4E66\u4EBA\u5DF2\u91CD\u7F6E\u4E3A\u7B2C 1 \u5929\uFF0C\u804A\u5929\u4E0E\u79C1\u804A\u8BB0\u5F55\u5DF2\u6E05\u7A7A\u3002',\n  });\n\n  return jsonResponse({ hall: updated }, {}, cors);\n}\n\nasync function handleAdvancePhase(request: Request, env: Env, code: string, cors: CorsOptions) {\n  const body = await readJson<AdvancePhaseBody>(request);\n  const storytellerKey = body.storytellerKey?.trim();\n  if (!storytellerKey || !body.action) {\n    return jsonResponse({ error: '\u7F3A\u5C11 storytellerKey \u6216 action' }, { status: 400 }, cors);\n  }\n\n  const hall = await env.DB.prepare(\n    'SELECT id, day_number as dayNumber, phase, storyteller_key FROM halls WHERE code = ? LIMIT 1',\n  )\n    .bind(code)\n    .first<HallRow & { dayNumber: number }>();\n\n  if (!hall || hall.storyteller_key !== storytellerKey) {\n    return jsonResponse({ error: '\u65E0\u6743\u9650\u64CD\u4F5C' }, { status: 403 }, cors);\n  }\n\n  const now = Date.now();\n  let nextPhase = hall.phase;\n  let nextDay = hall.dayNumber;\n\n  if (body.action === 'END_DAY') {\n    nextPhase = 'NIGHT';\n  } else if (body.action === 'START_DAY') {\n    nextPhase = 'DAY';\n    nextDay = hall.dayNumber + 1;\n  }\n\n  await env.DB.prepare('UPDATE halls SET phase = ?, day_number = ?, updated_at = ? WHERE id = ?')\n    .bind(nextPhase, nextDay, now, hall.id)\n    .run();\n\n  if (body.action === 'END_DAY') {\n    const activeSessions = await env.DB.prepare(\n      'SELECT id FROM private_sessions WHERE hall_id = ? AND status = ?',\n    )\n      .bind(hall.id, 'ACTIVE')\n      .all<{ id: string }>();\n\n    await env.DB.prepare(\n      'UPDATE private_sessions SET status = ?, ended_at = ?, ended_by_name = ? WHERE hall_id = ? AND status = ?',\n    )\n      .bind('ENDED', now, 'SYSTEM', hall.id, 'ACTIVE')\n      .run();\n\n    await env.DB.prepare(\n      \"UPDATE private_requests SET status = 'REJECTED', responded_at = ? WHERE hall_id = ? AND status = 'PENDING'\",\n    )\n      .bind(now, hall.id)\n      .run();\n\n    for (const session of activeSessions.results) {\n      const members = await env.DB.prepare(\n        'SELECT player_id as playerId FROM private_session_members WHERE session_id = ?',\n      )\n        .bind(session.id)\n        .all<{ playerId: string }>();\n      await broadcastToHall(env, hall.id, {\n        type: 'private:session-end',\n        sessionId: session.id,\n        endedByName: 'SYSTEM',\n        recipients: members.results.map((member) => member.playerId),\n      });\n    }\n  }\n\n  const updated = await env.DB.prepare(\n    'SELECT id, code, name, day_number as dayNumber, phase FROM halls WHERE id = ? LIMIT 1',\n  )\n    .bind(hall.id)\n    .first();\n\n  await broadcastToHall(env, hall.id, {\n    type: 'hall:update',\n    hall: updated as { id: string; code: string; name: string; dayNumber: number; phase: string },\n  });\n\n  if (body.action === 'END_DAY') {\n    await broadcastToHall(env, hall.id, {\n      type: 'system',\n      message: '\u5DF2\u8FDB\u5165\u9ED1\u591C\uFF0C\u516C\u5F00\u804A\u5929\u4E0E\u79C1\u804A\u5DF2\u6682\u505C\u3002',\n    });\n  }\n\n  return jsonResponse({ hall: updated }, {}, cors);\n}\n\nasync function handleCreatePrivateRequest(request: Request, env: Env, code: string, cors: CorsOptions) {\n  const body = await readJson<CreatePrivateRequestBody>(request);\n  const targetName = body.targetName?.trim();\n  if (!targetName) {\n    return jsonResponse({ error: '\u7F3A\u5C11\u76EE\u6807\u6635\u79F0' }, { status: 400 }, cors);\n  }\n\n  const hall = await env.DB.prepare('SELECT id, day_number as dayNumber, phase FROM halls WHERE code = ? LIMIT 1')\n    .bind(code)\n    .first<{ id: string; dayNumber: number; phase: string }>();\n\n  if (!hall) {\n    return jsonResponse({ error: '\u5927\u5385\u4E0D\u5B58\u5728' }, { status: 404 }, cors);\n  }\n\n  if (hall.phase === 'NIGHT') {\n    return jsonResponse({ error: '\u9ED1\u591C\u4E2D\u65E0\u6CD5\u53D1\u8D77\u79C1\u804A' }, { status: 403 }, cors);\n  }\n\n  const token = getToken(request);\n  const session = await requireSession(env, hall.id, token);\n  if (!session) {\n    return jsonResponse({ error: '\u672A\u6388\u6743' }, { status: 401 }, cors);\n  }\n\n  if (targetName === session.name) {\n    return jsonResponse({ error: '\u4E0D\u80FD\u9080\u8BF7\u81EA\u5DF1' }, { status: 400 }, cors);\n  }\n\n  const initiatorBusy = await env.DB.prepare(\n    \"SELECT 1 FROM private_session_members m JOIN private_sessions s ON s.id = m.session_id WHERE s.hall_id = ? AND s.status = 'ACTIVE' AND m.player_id = ? LIMIT 1\",\n  )\n    .bind(hall.id, session.playerId)\n    .first();\n\n  if (initiatorBusy) {\n    return jsonResponse({ error: '\u4F60\u6B63\u5728\u79C1\u804A\u4E2D' }, { status: 409 }, cors);\n  }\n\n  const target = await env.DB.prepare(\n    'SELECT id, name, is_online as isOnline FROM players WHERE hall_id = ? AND name = ? LIMIT 1',\n  )\n    .bind(hall.id, targetName)\n    .first<{ id: string; name: string; isOnline: number }>();\n\n  if (!target) {\n    return jsonResponse({ error: '\u672A\u627E\u5230\u8BE5\u73A9\u5BB6' }, { status: 404 }, cors);\n  }\n  if (!target.isOnline) {\n    return jsonResponse({ error: '\u5BF9\u65B9\u4E0D\u5728\u7EBF' }, { status: 409 }, cors);\n  }\n\n  const targetBusy = await env.DB.prepare(\n    \"SELECT 1 FROM private_session_members m JOIN private_sessions s ON s.id = m.session_id WHERE s.hall_id = ? AND s.status = 'ACTIVE' AND m.player_id = ? LIMIT 1\",\n  )\n    .bind(hall.id, target.id)\n    .first();\n\n  if (targetBusy) {\n    return jsonResponse({ error: '\u5BF9\u65B9\u6B63\u5728\u79C1\u804A\u4E2D' }, { status: 409 }, cors);\n  }\n\n  const now = Date.now();\n  const requestId = crypto.randomUUID();\n  await env.DB.prepare(\n    'INSERT INTO private_requests (id, hall_id, initiator_id, initiator_name, target_id, target_name, status, created_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?)',\n  )\n    .bind(requestId, hall.id, session.playerId, session.name, target.id, target.name, 'PENDING', now)\n    .run();\n\n  const requestPayload = {\n    id: requestId,\n    initiatorId: session.playerId,\n    initiatorName: session.name,\n    targetId: target.id,\n    targetName: target.name,\n    status: 'PENDING',\n    createdAt: now,\n  };\n\n  await broadcastToHall(env, hall.id, {\n    type: 'private:request',\n    request: requestPayload,\n    recipients: [session.playerId, target.id],\n  });\n\n  return jsonResponse({ request: requestPayload }, {}, cors);\n}\n\nasync function handleRespondPrivateRequest(\n  request: Request,\n  env: Env,\n  code: string,\n  requestId: string,\n  cors: CorsOptions,\n) {\n  const body = await readJson<RespondPrivateRequestBody>(request);\n  const response = body.response;\n  if (!response) {\n    return jsonResponse({ error: '\u7F3A\u5C11 response' }, { status: 400 }, cors);\n  }\n\n  const hall = await env.DB.prepare('SELECT id, day_number as dayNumber, phase FROM halls WHERE code = ? LIMIT 1')\n    .bind(code)\n    .first<{ id: string; dayNumber: number; phase: string }>();\n\n  if (!hall) {\n    return jsonResponse({ error: '\u5927\u5385\u4E0D\u5B58\u5728' }, { status: 404 }, cors);\n  }\n\n  const token = getToken(request);\n  const session = await requireSession(env, hall.id, token);\n  if (!session) {\n    return jsonResponse({ error: '\u672A\u6388\u6743' }, { status: 401 }, cors);\n  }\n\n  const requestRow = await env.DB.prepare(\n    'SELECT id, initiator_id, initiator_name, target_id, target_name, status, created_at FROM private_requests WHERE id = ? AND hall_id = ? LIMIT 1',\n  )\n    .bind(requestId, hall.id)\n    .first<{\n      id: string;\n      initiator_id: string;\n      initiator_name: string;\n      target_id: string;\n      target_name: string;\n      status: string;\n      created_at: number;\n    }>();\n\n  if (!requestRow) {\n    return jsonResponse({ error: '\u79C1\u804A\u8BF7\u6C42\u4E0D\u5B58\u5728' }, { status: 404 }, cors);\n  }\n\n  if (requestRow.target_id !== session.playerId) {\n    return jsonResponse({ error: '\u65E0\u6743\u5904\u7406\u8BE5\u8BF7\u6C42' }, { status: 403 }, cors);\n  }\n\n  if (requestRow.status !== 'PENDING') {\n    return jsonResponse({ error: '\u8BE5\u8BF7\u6C42\u5DF2\u5904\u7406' }, { status: 409 }, cors);\n  }\n\n  const now = Date.now();\n  const nextStatus = response === 'ACCEPT' ? 'ACCEPTED' : 'REJECTED';\n  await env.DB.prepare('UPDATE private_requests SET status = ?, responded_at = ? WHERE id = ?')\n    .bind(nextStatus, now, requestId)\n    .run();\n\n  const requestPayload = {\n    id: requestRow.id,\n    initiatorId: requestRow.initiator_id,\n    initiatorName: requestRow.initiator_name,\n    targetId: requestRow.target_id,\n    targetName: requestRow.target_name,\n    status: nextStatus,\n    createdAt: requestRow.created_at,\n  };\n\n  let sessionPayload: null | {\n    id: string;\n    participants: string[];\n    status: 'ACTIVE';\n    dayNumber: number;\n    createdAt: number;\n  } = null;\n\n  if (nextStatus === 'ACCEPTED') {\n    const sessionId = crypto.randomUUID();\n    await env.DB.prepare(\n      'INSERT INTO private_sessions (id, hall_id, day_number, status, created_at) VALUES (?, ?, ?, ?, ?)',\n    )\n      .bind(sessionId, hall.id, hall.dayNumber, 'ACTIVE', now)\n      .run();\n\n    await env.DB.prepare(\n      'INSERT INTO private_session_members (session_id, player_id, player_name) VALUES (?, ?, ?), (?, ?, ?)',\n    )\n      .bind(\n        sessionId,\n        requestRow.initiator_id,\n        requestRow.initiator_name,\n        sessionId,\n        requestRow.target_id,\n        requestRow.target_name,\n      )\n      .run();\n\n    sessionPayload = {\n      id: sessionId,\n      participants: [requestRow.initiator_name, requestRow.target_name],\n      status: 'ACTIVE',\n      dayNumber: hall.dayNumber,\n      createdAt: now,\n    };\n  }\n\n  await broadcastToHall(env, hall.id, {\n    type: 'private:request-update',\n    request: requestPayload,\n    recipients: [requestRow.initiator_id, requestRow.target_id],\n  });\n\n  if (sessionPayload) {\n    await broadcastToHall(env, hall.id, {\n      type: 'private:session-start',\n      session: sessionPayload,\n      recipients: [requestRow.initiator_id, requestRow.target_id],\n    });\n  }\n\n  return jsonResponse({ request: requestPayload, session: sessionPayload }, {}, cors);\n}\n\nasync function handleWebSocket(request: Request, env: Env, code: string) {\n  const hall = await env.DB.prepare('SELECT id FROM halls WHERE code = ? AND status = ? LIMIT 1')\n    .bind(code, 'active')\n    .first<{ id: string }>();\n\n  if (!hall) {\n    return new Response('\u5927\u5385\u4E0D\u5B58\u5728', { status: 404 });\n  }\n\n  const token = new URL(request.url).searchParams.get('token');\n  if (!token) {\n    return new Response('\u7F3A\u5C11 token', { status: 401 });\n  }\n\n  const stub = env.HALL_ROOM.get(env.HALL_ROOM.idFromName(hall.id));\n  const headers = new Headers(request.headers);\n  headers.set('X-Hall-Id', hall.id);\n  headers.set('X-Session-Token', token);\n\n  return stub.fetch('https://hall-room/connect', {\n    method: 'GET',\n    headers,\n  });\n}\n\nasync function generateUniqueHallCode(env: Env) {\n  for (let attempt = 0; attempt < 5; attempt += 1) {\n    const code = randomHallCode();\n    const existing = await env.DB.prepare('SELECT id FROM halls WHERE code = ? LIMIT 1').bind(code).first();\n    if (!existing) return code;\n  }\n  throw new Error('\u65E0\u6CD5\u751F\u6210\u552F\u4E00\u5927\u5385\u7801');\n}\n\nfunction getToken(request: Request) {\n  const auth = request.headers.get('Authorization');\n  if (auth && auth.startsWith('Bearer ')) {\n    return auth.slice(7);\n  }\n  return new URL(request.url).searchParams.get('token');\n}\n\nasync function requireSession(env: Env, hallId: string, token: string | null) {\n  if (!token) return null;\n  const payload = await verifySessionToken(token, getTokenSecret(env));\n  if (!payload || payload.hallId !== hallId) return null;\n\n  const player = await env.DB.prepare('SELECT session_version FROM players WHERE id = ? AND hall_id = ?')\n    .bind(payload.playerId, hallId)\n    .first<{ session_version: number }>();\n\n  if (!player || player.session_version !== payload.ver) return null;\n  return payload;\n}\n\nfunction buildCorsOptions(request: Request, env: Env): CorsOptions {\n  return {\n    origin: request.headers.get('Origin'),\n    allowedOrigins: parseCorsOrigins(env.CORS_ORIGINS),\n  };\n}\n\nasync function broadcastToHall(\n  env: Env,\n  hallId: string,\n  payload: Record<string, unknown> & { type: string; recipients?: string[] },\n) {\n  const stub = env.HALL_ROOM.get(env.HALL_ROOM.idFromName(hallId));\n  await stub.fetch('https://hall-room/broadcast', {\n    method: 'POST',\n    body: JSON.stringify(payload),\n  });\n}\n\nfunction getTokenSecret(env: Env) {\n  return resolveTokenSecret(env.TOKEN_SECRET);\n}\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"D:\\\\Desktop\\\\Document\\\\Codes\\\\Test-Alpha\\\\backend\\\\src\\\\worker.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"D:\\\\Desktop\\\\Document\\\\Codes\\\\Test-Alpha\\\\backend\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"D:\\\\Desktop\\\\Document\\\\Codes\\\\Test-Alpha\\\\backend\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"D:\\\\Desktop\\\\Document\\\\Codes\\\\Test-Alpha\\\\backend\\\\src\\\\worker.ts\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"D:\\\\Desktop\\\\Document\\\\Codes\\\\Test-Alpha\\\\backend\\\\.wrangler\\\\tmp\\\\bundle-kC6kAk\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"D:\\\\Desktop\\\\Document\\\\Codes\\\\Test-Alpha\\\\backend\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"D:\\\\Desktop\\\\Document\\\\Codes\\\\Test-Alpha\\\\backend\\\\.wrangler\\\\tmp\\\\bundle-kC6kAk\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"D:\\\\Desktop\\\\Document\\\\Codes\\\\Test-Alpha\\\\backend\\\\.wrangler\\\\tmp\\\\bundle-kC6kAk\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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",
  "names": []
}
